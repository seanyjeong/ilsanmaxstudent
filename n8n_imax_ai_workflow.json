{
  "name": "IMAX AI í•™ìƒìš© ì±—ë´‡",
  "nodes": [
    {
      "parameters": {
        "options": {
          "allowedOrigins": "*"
        }
      },
      "id": "chat-trigger",
      "name": "Chat Trigger",
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [0, 0],
      "webhookId": "imax-student-chat"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.sessionId }}",
        "contextWindowLength": 10
      },
      "id": "memory-intent",
      "name": "Memory - ì˜ë„ë¶„ì„",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [220, 100]
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.0-flash-exp",
          "mode": "list",
          "cachedResultName": "gemini-2.0-flash-exp"
        },
        "options": {}
      },
      "id": "gemini-intent",
      "name": "Gemini - ì˜ë„ ë¶„ì„",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [220, 0],
      "credentials": {
        "googleGeminiApi": {
          "id": "",
          "name": "Google Gemini API"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.chatInput }}",
        "options": {
          "systemMessage": "ë„ˆëŠ” JSON ë¼ìš°í„°ì•¼. ì‚¬ìš©ì ì…ë ¥ì„ ë¶„ì„í•´ì„œ ì ì ˆí•œ APIë¥¼ í˜¸ì¶œí•˜ëŠ” JSONë§Œ ì¶œë ¥í•´.\n\nì¤‘ìš”: ëŒ€í•™/ì…ì‹œ ê´€ë ¨ ì§ˆë¬¸ì€ ë¬´ì¡°ê±´ API í˜¸ì¶œí•´. ë„¤ ì§€ì‹ìœ¼ë¡œ ëŒ€ë‹µí•˜ì§€ ë§ˆ.\n\n## ì§ˆë¬¸ ìœ í˜• ë¶„ë¥˜ (info_type) - ë§¤ìš° ì¤‘ìš”!\n- ratio: ë°˜ì˜ë¹„ìœ¨, ì‹¤ê¸°ë¹„ì¤‘, ìˆ˜ëŠ¥ë¹„ì¤‘ ì§ˆë¬¸\n- score_table: ë°°ì í‘œ, ì‹¤ê¸°ë°°ì , ê¸°ë¡í‘œ ì§ˆë¬¸\n- basic: ëª¨ì§‘ì •ì›, ì‹¤ê¸°ì¢…ëª©, ê¸°ë³¸ì •ë³´ ì§ˆë¬¸\n- all: ì „ì²´ ì •ë³´, ìƒì„¸ì •ë³´, ê·¸ëƒ¥ ëŒ€í•™ëª…ë§Œ ê²€ìƒ‰\n\n## ëŒ€í™” ë§¥ë½ ì²˜ë¦¬\n- ì´ì „ ëŒ€í™”ì—ì„œ ì–¸ê¸‰ëœ ëŒ€í•™+í•™ê³¼ê°€ ìˆìœ¼ë©´ ë§¥ë½ ìœ ì§€\n\n## ëŒ€í•™ëª… ì•½ì–´\nì„±ì‹ /ì„±ì‹ ì—¬ëŒ€â†’ì„±ì‹ ì—¬ìëŒ€í•™êµ, ìˆ™ëŒ€/ìˆ™ëª…â†’ìˆ™ëª…ì—¬ìëŒ€í•™êµ, êµ­ëŒ€/êµ­ë¯¼ëŒ€â†’êµ­ë¯¼ëŒ€í•™êµ, í•œëŒ€/í•œì–‘ëŒ€â†’í•œì–‘ëŒ€í•™êµ, ì²´ëŒ€/í•œì²´ëŒ€â†’í•œêµ­ì²´ìœ¡ëŒ€í•™êµ, ìš©ëŒ€/ìš©ì¸ëŒ€â†’ìš©ì¸ëŒ€í•™êµ, ê²½í¬ëŒ€â†’ê²½í¬ëŒ€í•™êµ, ì¤‘ëŒ€/ì¤‘ì•™ëŒ€â†’ì¤‘ì•™ëŒ€í•™êµ, ë‹¨ëŒ€/ë‹¨êµ­ëŒ€â†’ë‹¨êµ­ëŒ€í•™êµ, ê°€ì²œëŒ€â†’ê°€ì²œëŒ€í•™êµ, ìˆ­ì‹¤ëŒ€â†’ìˆ­ì‹¤ëŒ€í•™êµ\n\n## í•™ê³¼ëª… ì•½ì–´\nìŠ¤êµâ†’ìŠ¤í¬ì¸ êµìœ¡, ì²´êµâ†’ì²´ìœ¡êµìœ¡, ìŠ¤ê³¼â†’ìŠ¤í¬ì¸ ê³¼í•™, ìŠ¤ë ˆâ†’ìŠ¤í¬ì¸ ë ˆì €, ìš´ì¬â†’ìš´ë™ì¬í™œ, ìŠ¤ì‚°â†’ìŠ¤í¬ì¸ ì‚°ì—…, ìƒì²´â†’ìƒí™œì²´ìœ¡, íŠ¹ì²´â†’íŠ¹ìˆ˜ì²´ìœ¡\n\n## ì¶œë ¥ í˜•ì‹ (JSONë§Œ, ì½”ë“œë¸”ë¡ ì—†ì´)\n{\"action\":\"api\",\"type\":\"university\",\"endpoint\":\"search\",\"info_type\":\"ratio|score_table|basic|all\",\"params\":{\"name\":\"ê²€ìƒ‰ì–´\",\"year\":2026}}\n{\"action\":\"chat\",\"message\":\"ì‘ë‹µ\"}\n{\"action\":\"random\",\"random_pick\":true,\"participants\":[\"ì´ë¦„1\",\"ì´ë¦„2\"]}\n\n## ì˜ˆì‹œ\nìˆ­ì‹¤ëŒ€ ì‹¤ê¸° ë¹„ì¤‘ ëª‡í”„ë¡œ? â†’ {\"action\":\"api\",\"type\":\"university\",\"endpoint\":\"search\",\"info_type\":\"ratio\",\"params\":{\"name\":\"ìˆ­ì‹¤ëŒ€í•™êµ\",\"year\":2026}}\nì„±ì‹ ì—¬ëŒ€ ìš´ì¬ ë°°ì í‘œ â†’ {\"action\":\"api\",\"type\":\"university\",\"endpoint\":\"search\",\"info_type\":\"score_table\",\"params\":{\"name\":\"ì„±ì‹ ì—¬ìëŒ€í•™êµ ìš´ë™ì¬í™œ\",\"year\":2026}}\nêµ­ë¯¼ëŒ€ ìŠ¤êµ ëª¨ì§‘ì •ì› â†’ {\"action\":\"api\",\"type\":\"university\",\"endpoint\":\"search\",\"info_type\":\"basic\",\"params\":{\"name\":\"êµ­ë¯¼ëŒ€í•™êµ ìŠ¤í¬ì¸ êµìœ¡\",\"year\":2026}}\ní•œì–‘ëŒ€ ì •ë³´ â†’ {\"action\":\"api\",\"type\":\"university\",\"endpoint\":\"search\",\"info_type\":\"all\",\"params\":{\"name\":\"í•œì–‘ëŒ€í•™êµ\",\"year\":2026}}\nì² ìˆ˜ ì˜í¬ ë½‘ì•„ â†’ {\"action\":\"random\",\"random_pick\":true,\"participants\":[\"ì² ìˆ˜\",\"ì˜í¬\"]}\nì•ˆë…• â†’ {\"action\":\"chat\",\"message\":\"ì•ˆë…•í•˜ì„¸ìš”! IMAX AI ì…ì‹œ ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤. ëŒ€í•™ ì •ë³´ë‚˜ ì‹¤ê¸° ë°°ì í‘œê°€ ê¶ê¸ˆí•˜ì‹œë©´ ë¬¼ì–´ë´ì£¼ì„¸ìš”!\"}"
        }
      },
      "id": "agent-intent",
      "name": "AI Agent - ì˜ë„ë¶„ì„",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [440, 0]
    },
    {
      "parameters": {
        "jsCode": "let output = $input.first().json.output;\n// Remove markdown code blocks if present\noutput = output.replace(/```json\\n?/g, '').replace(/```\\n?/g, '').trim();\ntry {\n  const parsed = JSON.parse(output);\n  return [{ json: parsed }];\n} catch(e) {\n  // JSON íŒŒì‹± ì‹¤íŒ¨ì‹œ ì¼ë°˜ ëŒ€í™”ë¡œ ì²˜ë¦¬\n  return [{ json: { action: 'chat', message: output } }];\n}"
      },
      "id": "parse-intent",
      "name": "JSON íŒŒì‹±",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [660, 0]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "api-check",
              "leftValue": "={{ $json.action }}",
              "rightValue": "api",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "if-api",
      "name": "API í˜¸ì¶œ í•„ìš”?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [880, 0]
    },
    {
      "parameters": {
        "jsCode": "const data = $input.first().json;\nconst endpoint = data.endpoint;\nconst params = data.params || {};\nconst infoType = data.info_type || 'all';\n\nlet url = `http://211.37.174.218:8321/maxai/api/universities/${endpoint}`;\n\n// Build query string\nconst queryParams = Object.entries(params)\n  .filter(([k, v]) => v !== undefined && v !== null && v !== '')\n  .map(([k, v]) => `${k}=${encodeURIComponent(v)}`)\n  .join('&');\n\nif (queryParams) {\n  url += '?' + queryParams;\n}\n\nreturn [{ json: { url, params, info_type: infoType } }];"
      },
      "id": "build-url",
      "name": "URL ìƒì„±",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1100, -100]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "={{ $json.url }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "ilsan-max-ai-key-2024"
            }
          ]
        },
        "options": {}
      },
      "id": "http-api",
      "name": "API í˜¸ì¶œ",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1320, -100]
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.0-flash-exp",
          "mode": "list",
          "cachedResultName": "gemini-2.0-flash-exp"
        },
        "options": {}
      },
      "id": "gemini-response",
      "name": "Gemini - ì‘ë‹µ ìƒì„±",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [1540, -100],
      "credentials": {
        "googleGeminiApi": {
          "id": "",
          "name": "Google Gemini API"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=ì‚¬ìš©ì ì§ˆë¬¸: {{ $('Chat Trigger').item.json.chatInput }}\nìš”ì²­ ì •ë³´ ìœ í˜•: {{ $('URL ìƒì„±').item.json.info_type }}\n\nAPI ì‘ë‹µ ë°ì´í„°:\n{{ JSON.stringify($json, null, 2) }}",
        "options": {
          "systemMessage": "ë„ˆëŠ” IMAX ì…ì‹œ AI ì–´ì‹œìŠ¤í„´íŠ¸ì•¼. APIì—ì„œ ë°›ì€ ë°ì´í„°ë¥¼ ìì—°ìŠ¤ëŸ¬ìš´ í•œêµ­ì–´ë¡œ ì„¤ëª…í•´ì¤˜.\n\n## ê°€ì¥ ì¤‘ìš”í•œ ê·œì¹™\n- APIì—ì„œ ë°›ì€ ë°ì´í„°ë§Œ ì‚¬ìš©!\n- ìš”ì²­ ì •ë³´ ìœ í˜•(info_type)ì— ë§ëŠ” ì •ë³´ë§Œ ê°„ê²°í•˜ê²Œ ë‹µë³€!\n\n## info_typeë³„ ì‘ë‹µ (ë§¤ìš° ì¤‘ìš”!)\n\n### ratio (ë°˜ì˜ë¹„ìœ¨ ì§ˆë¬¸)\nìˆ˜ëŠ¥/ì‹¤ê¸° ë¹„ìœ¨ë§Œ ê°„ë‹¨íˆ! ì˜ˆ: \"ìˆ­ì‹¤ëŒ€ ìŠ¤í¬ì¸ í•™ë¶€ëŠ” ìˆ˜ëŠ¥ 60%, ì‹¤ê¸° 40% ë°˜ì˜ì…ë‹ˆë‹¤.\"\n\n### basic (ê¸°ë³¸ì •ë³´ ì§ˆë¬¸)\nëª¨ì§‘ì •ì›, ì‹¤ê¸°ì¢…ëª© ë“± ë¬¼ì–´ë³¸ ê²ƒë§Œ ë‹µë³€!\n\n### score_table (ë°°ì í‘œ ì§ˆë¬¸)\nì‹¤ê¸°ë°°ì í‘œë¥¼ ì•„ë˜ í˜•ì‹ìœ¼ë¡œ:\nğŸ“Š [ì¢…ëª©ëª…]\n* 100ì : ë‚¨ OO / ì—¬ OO\n* 96ì : ë‚¨ OO / ì—¬ OO\n...\n(ì—¬ëŒ€ëŠ” ì—¬ ê¸°ë¡ë§Œ)\n\n### all (ì „ì²´ì •ë³´)\nê¸°ë³¸ì •ë³´ + ë°˜ì˜ë¹„ìœ¨ + ë°°ì í‘œ ëª¨ë‘\n\n## ê³µí†µ ê·œì¹™\n- ì¹œì ˆí•˜ê³  ê°„ê²°í•˜ê²Œ\n- ì´ëª¨ì§€ ì ì ˆíˆ ì‚¬ìš©\n- ê²€ìƒ‰ ê²°ê³¼ ì—¬ëŸ¬ ê°œë©´ ëª©ë¡ë§Œ ë³´ì—¬ì£¼ê³  ì„ íƒ ìš”ì²­"
        }
      },
      "id": "agent-response",
      "name": "AI Agent - ì‘ë‹µìƒì„±",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [1760, -100]
    },
    {
      "parameters": {
        "jsCode": "const output = $input.first().json.output;\nreturn [{ json: { output: output } }];"
      },
      "id": "format-api-response",
      "name": "API ì‘ë‹µ í¬ë§·",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1980, -100]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "random-check",
              "leftValue": "={{ $json.action }}",
              "rightValue": "random",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "if-random",
      "name": "ëœë¤ ë½‘ê¸°?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1100, 100]
    },
    {
      "parameters": {
        "jsCode": "const data = $input.first().json;\nconst participants = data.participants || [];\n\nif (participants.length < 2) {\n  return [{ json: { output: 'âš ï¸ 2ëª… ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”!' } }];\n}\n\n// ê° ì°¸ê°€ìì—ê²Œ 1-99 ì ìˆ˜ ë¶€ì—¬\nconst results = participants.map(name => ({\n  name,\n  score: Math.floor(Math.random() * 99) + 1\n}));\n\n// ì ìˆ˜ ë†’ì€ ìˆœ ì •ë ¬\nresults.sort((a, b) => b.score - a.score);\nconst winner = results[0];\n\n// ê²°ê³¼ ë©”ì‹œì§€\nlet msg = 'ğŸ² ì£¼ì‚¬ìœ„ ê²°ê³¼!\\n\\n';\nresults.forEach((r, i) => {\n  const medal = i === 0 ? 'ğŸ†' : (i === 1 ? 'ğŸ¥ˆ' : (i === 2 ? 'ğŸ¥‰' : ''));\n  msg += `${medal} ${r.name}: ${r.score}ì \\n`;\n});\nmsg += `\\nğŸ‰ ë‹¹ì²¨: ${winner.name}ë‹˜!`;\n\nreturn [{ json: { output: msg } }];"
      },
      "id": "random-pick",
      "name": "ëœë¤ ë½‘ê¸° ì‹¤í–‰",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1320, 100]
    },
    {
      "parameters": {
        "jsCode": "const message = $input.first().json.message || 'ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?';\nreturn [{ json: { output: message } }];"
      },
      "id": "format-chat-response",
      "name": "ì¼ë°˜ëŒ€í™” ì‘ë‹µ í¬ë§·",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1320, 200]
    }
  ],
  "connections": {
    "Chat Trigger": {
      "main": [
        [
          {
            "node": "AI Agent - ì˜ë„ë¶„ì„",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini - ì˜ë„ ë¶„ì„": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent - ì˜ë„ë¶„ì„",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Memory - ì˜ë„ë¶„ì„": {
      "ai_memory": [
        [
          {
            "node": "AI Agent - ì˜ë„ë¶„ì„",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent - ì˜ë„ë¶„ì„": {
      "main": [
        [
          {
            "node": "JSON íŒŒì‹±",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "JSON íŒŒì‹±": {
      "main": [
        [
          {
            "node": "API í˜¸ì¶œ í•„ìš”?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "API í˜¸ì¶œ í•„ìš”?": {
      "main": [
        [
          {
            "node": "URL ìƒì„±",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ëœë¤ ë½‘ê¸°?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "URL ìƒì„±": {
      "main": [
        [
          {
            "node": "API í˜¸ì¶œ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "API í˜¸ì¶œ": {
      "main": [
        [
          {
            "node": "AI Agent - ì‘ë‹µìƒì„±",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini - ì‘ë‹µ ìƒì„±": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent - ì‘ë‹µìƒì„±",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent - ì‘ë‹µìƒì„±": {
      "main": [
        [
          {
            "node": "API ì‘ë‹µ í¬ë§·",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ëœë¤ ë½‘ê¸°?": {
      "main": [
        [
          {
            "node": "ëœë¤ ë½‘ê¸° ì‹¤í–‰",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ì¼ë°˜ëŒ€í™” ì‘ë‹µ í¬ë§·",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  }
}
